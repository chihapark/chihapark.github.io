<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8"> <!-- Site title --> <title>Developer Chiha - 개발자 공부 공간</title> <meta http-equip="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Site Description --> <meta name="description" content="A Jekyll Theme Built For Developers"> <!-- Stylesheets goes here --> <link rel="stylesheet" href="/assets/css/main.css" /> <!-- Favicon --> <link rel="icon" href="/assets/img/favicon.ico" type="image/gif" sizes="16x16"> <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet"> <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous"> <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous"> <script> (function(d, h, m){ var js, fjs = d.getElementsByTagName(h)[0]; if (d.getElementById(m)){return;} js = d.createElement(h); js.id = m; js.onload = function(){ window.makerWidgetComInit({ position: "right", widget: "ofeeof264otl2l5g-zspk40eq2gaomj2n-higi2qphmveubksi" })}; js.src = "https://makerwidget.com/js/embed.js"; fjs.parentNode.insertBefore(js, fjs) }(document, "script", "dhm")) </script> <!-- HTML5 shim, for IE6-8 support of HTML5 elements --> <!--[if lt IE 9]> <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script> <![endif]--> </head><body> <div class="container-fluid"><header> <div class="col-lg-12"> <div class="row"> <div class="col-md-2 center"> <a href="/"> <img src="/assets/img/profile.png" class="profile-img"> </a> </div> <div class="col-md-4"> <h1 class="profile-name"> Developer Chiha</h1> <p class="profile-bio"> 개발자 공부 공간</p> <!-- <p class="profile-links"> <a class="social-link" href="http://twitter.com/yourusername"> <i class="fab fa-twitter"></i> </a> <a class="social-link" href="http://facebook.com/yourusername"> <i class="fab fa-facebook-f"></i> </a> <a class="social-link" href="http://instagram.com/yourusername"> <i class="fab fa-instagram"></i> </a> <a class="social-link" href="http://medium.com/@yourusername"> <i class="fab fa-medium-m"></i> </a> <a class="social-link" href="http://github.com/yourusername"> <i class="fab fa-github"></i> </a> <a class="social-link" href="http://behance.net/yourusername"> <i class="fab fa-behance"></i> </a> <a class="social-link" href="http://linkedin.com/in/yourusername"> <i class="fab fa-linkedin-in"></i> </a> <a class="social-link" href="http://t.me/yourusername"> <i class="fab fa-telegram-plane"></i> </a> </p> --> </div> <div class="col-md-6 center"> <ul class="nav justify-content-end" id="navigation"><li class="nav-item"> <a class="nav-link" href="/about">About</a> </li><li class="nav-item"> <a class="nav-link" href="/blog">Blog</a> </li><li class="nav-item"> <a class="nav-link" href="/contact">Contact</a> </li></ul></div> </div> </div> </header> <!-- Google Adsense --> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <script> (adsbygoogle = window.adsbygoogle || []).push({ google_ad_client: "ca-pub-7259836434848202", enable_page_level_ads: true }); </script><div class="col-lg-12"> <!-- Blog Post Breadcrumbs --><nav aria-label="breadcrumb" role="navigation"> <ol class="breadcrumb"> <li class="breadcrumb-item"> <a href="/blog">Blog</a> </li> <li class="breadcrumb-item"> <a href="/blog/categories">Categories</a> </li> <li class="breadcrumb-item active" aria-current="page">PostgreSQL Recovery</li> </ol> </nav> <div class="row"> <div class="col-lg-8"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <!-- <h1 class="post-title" itemprop="name headline">PostgreSQL Recovery</h1> --> <h4 class="post-meta">PostgreSQL</h4> <p class="post-summary">Posted by : <img src="/assets/img/profile.png" class="author-profile-img"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name">Chiha Park</span> </span> at <time datetime="2019-07-29 18:30:00 +0000" itemprop="datePublished">Jul 29, 2019</time> </p> <span class="disqus-comment-count" data-disqus-identifier="/postgresql/2019/07/29/postgresql-recovery.html"></span> <div class="post-categories"> Category : <a href="/blog/categories/PostgreSQL">PostgreSQL</a> </div> </div> <div class="card-body" itemprop="articleBody"> <img class="card-img-top" src="/assets/img/posts/postgresql.jpg" alt=""> <p><br /></p> <h1 id="postgresql-복구-recovery">PostgreSQL 복구 (Recovery)</h1> <p><br /></p> <h2 id="1-basetar-압축-해제">1. base.tar 압축 해제</h2> <ul> <li>pg_basebackup을 tar 방식으로 Backup을 하면 base.tar 압축 파일이 생성된다.</li> </ul> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tar -zxvf base.tar.gz -C /data/PGDATABASE/data/pg
</code></pre></div></div> <p><br /></p> <h2 id="2-user-tablespace-backup-압축-해제-및-symbolic-link-생성">2. user tablespace backup 압축 해제 및 Symbolic link 생성</h2> <ul> <li>/data/PGDATABASE/data/pg/tablespace_map 확인</li> <li>Tablespace 별로 Path를 확인하여 해당 경로에 압축 해제 및 Tablespace 영역 Symbolic link 생성</li> <li>Ex) 16385 /data/PGDATABASE/TS01, 16387 /data/PGDATABASE/TS02</li> </ul> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tar -zxvf 16385.tar.gz -C /data/PGDATABASE/TS01
ln -s /data/PGDATABASE/TS01 /data/PGDATABASE/data/pg/pg_tblspc/

tar -zxvf 16387.tar.gz -C /data/PGDATABASE/TS02
ln -s /data/PGDATABASE/TS02 /data/PGDATABASE/data/pg/pg_tblspc/
</code></pre></div></div> <p><br /></p> <h2 id="3-wal-file-이동pg_xlog-및-symbolic-link-생성">3. WAL file 이동(pg_xlog) 및 symbolic link 생성</h2> <ul> <li>pg_xlog 영역 분리</li> <li>혹시 남아 있을지 모를 pg_xlog 파일을 분리 된 pg_xlog 디렉토리 영역으로 복사</li> </ul> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mv /data/PGDATABASE/data/pg/pg_xlog/* /data/PGDATABASE/pg_xlog
rm -rf /data/PGDATABASE/data/pg/pg_xlog
ln -s /data/PGDATABASE/pg_xlog /data/PGDATABASE/data/pg/pg_xlog
</code></pre></div></div> <p><br /></p> <hr /> <h2 id="4-pitr특정-시간으로-복구를-원할-경우">4. PITR(특정 시간으로 복구)를 원할 경우</h2> <ul> <li>백업 시점으로 복구를 원할 시에는 이 단계를 SKIP</li> <li>백업 시점 이후부터 돌아가고 싶은 시간까지의 archive 파일이 존재해야한다.</li> <li>Ex) 000000010000000000000003 000000010000000000000004는 archive 파일이라 가정</li> </ul> <p><br /></p> <h3 id="1-arch-파일-이동">1. arch 파일 이동</h3> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mv 000000010000000000000003 000000010000000000000004 /data/PGDATABASE/arch
</code></pre></div></div> <p><br /></p> <h3 id="2-recoveryconf-파일-생성">2. recovery.conf 파일 생성</h3> <ul> <li>vi /data/PGDATABASE/data/pg/recovery.conf</li> </ul> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>restore_command = 'cp /data/PGDATABASE/arch/%f %p'
archive_cleanup_command = 'pg_archivecleanup /data/PGDATABASE/arch %r'
recovery_target_time = '2019-07-30 12:30:10 EST'
</code></pre></div></div> <hr /> <p><br /></p> <h2 id="5-postgresql-start">5. PostgreSQL Start</h2> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>su - pgadmin -c 'pg_ctl start;'
</code></pre></div></div> </div> </article> </div><div class="col-lg-4"> <div class="card"> <div class="card-header"> About </div> <div class="card-body text-dark"> <!-- Your Bio --> <p> Hello, my name is Chiha Park. I am an Software Developer and Cloud/DB Engineer</p> </div> </div> <div class="card"> <div class="card-header">Categories </div> <div class="card-body text-dark"> <div id="#PostgreSQL"></div> <li class="tag-head"> <a href="/blog/categories/PostgreSQL">PostgreSQL</a> </li> <a name="PostgreSQL"></a> <div id="#Linux"></div> <li class="tag-head"> <a href="/blog/categories/Linux">Linux</a> </li> <a name="Linux"></a> </div> </div> </div></div> <!-- End of row--> </div> <footer> <p> Powered by<a href="https://devlopr.netlify.com/readme"> devlopr jekyll</a>. Hosted at <a href="https://pages.github.com">Github</a>. Subscribe via <a href=" /feed.xml ">RSS</a> </p> </footer> <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script> <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script> </div> </body> </html>
